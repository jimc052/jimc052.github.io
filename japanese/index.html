
<!DOCTYPE html>
<html>
<head>
	<title>日文</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Security-Policy" content="default-src *; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'; media-src *; img-src * filesystem: data:">
	
	<!-- 
	<script src="https://unpkg.com/vue@2.7.14/dist/vue.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/iview@3.5.4/dist/styles/iview.css">
	<script src="https://unpkg.com/iview@3.5.4/dist/iview.min.js"></script>
	<script src="https://unpkg.com/iview@3.5.4/dist/locale/zh-TW.js"></script>
	 -->

	<script src="../statics/vue.js"></script>
	<link href="../statics/iview/iview.min.css" rel="stylesheet">
	<script src="../statics/iview/iview.js"></script>
	<script src="../statics/iview/zh-TW.min.js"></script>

	<script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-auth.js"></script>
	<script src="../VOA/system/fireStore.js"></script>
	<script src="../VOA/system/system.js"></script>

	<script src="./system.js"></script>
	<script src="./TTX.js"></script>
	<script src="./Player.js"></script>
	<script src="./pronounce.js"></script>
	<script src="./letter.js"></script>
	<script src="./letter-1.js"></script>
	<script src="./letter-all.js"></script>
	<script src="./letter-exam.js"></script>
	<script src="./vocabulary.js"></script>
	<script src="./vocabulary-editor.js"></script>
	<script src="./vocabulary-sort.js"></script>
	<script src="./preview.js"></script>
	<script src="./canvas.js"></script>
	<script src="./lesson.js"></script>
	<script src="./lesson-exam.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"></script>

	<style>
		* {
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			/* user-select: none; */
			font-family: 'Times New Roman', 'Helvetica Neue', 微軟正黑體, 'Microsoft Jhenghei', Helvetica, Arial, sans-serif;
			font-size: 16px;
		}
		body {
			/* margin: 10px; */
			background-color: #ebecf0;
			padding: 0px 0px;
			visibility: hidden;
			color: rgb(0, 0, 0);
		}
		html, body, #app {
			min-height: 100% !important;
			height: 100%;
		}

		@media screen and (min-width: 400px) {
			#tbl50 td {
				font-size: 24px;
			}

			#tbl50 tr:first-child td, #tbl50 td:first-child {
				font-size: 24px !important;
			}
		}

		@media screen and (min-width: 800px) {
			#tbl50 td {
				font-size: 30px;
			}

			#tbl50 tr:first-child td, #tbl50 td:first-child {
				font-size: 24px !important;
			}

			label {
				font-size: 20px !important;
				line-height: 40px !important;
				height: 40px  !important;
			}
		}

		#tbl50 {
      /* margin: 10px; */
    }
		#tbl50 td * {
			font-size: inherit;
		}

    #tbl50 td {
      font-family: "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
      border: 1px solid black;
      text-align: center;
    }

    #tbl50 tr:first-child td, #tbl50 td:first-child {
      color: #2d8cf0;
      /* padding: 5px 0px; */
    }

    #tbl50 td:first-child {
      width: 10%;
    }

    #tbl50 td.cell {
      width: 18%;
      cursor: pointer;
    }
		#tbl50 *.active {
      color: white !important;
			background-color: rgb(45, 140, 240);
    }

		#tbl50 td.hidden {
			display: none;
		}

		.ivu-table-header thead tr th, .ivu-table-fixed-header thead tr th{
			padding: 0px;
		}
		.ivu-table-cell {
			padding-left: 5px !important;
			padding-right: 5px !important;
			font-family: "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
		}
		.ivu-table td, .ivu-table th {
			height: 35px  !important;
		}
		.ivu-table th, .ivu-table th .ivu-table-cell {
			text-align: center !important;
		}
		.ivu-table td:first-child {
			/* cursor: pointer; */
			background-color: #f8f8f9;
		}
		.ivu-table-row-highlight td:first-child {
			background-color: #ebf7ff;
			color: #C0C0C0;
			font-weight: 700;
		}
		.ivu-menu-item {
			padding-left: 10px 0px 10px 20px;
			cursor: pointer;
			font-size: 20px;
			padding: 10px;
			border-right: 1px solid white;
		}
		.ivu-menu-item + .ivu-menu-item {
			/* margin-top: 0px; */
		}
		.ivu-menu-item-active {
			color: #2d8cf0; 
			background: #f0faff;
			border-right: 1px solid #2d8cf0;
		}
		.button {
			width: 40px; 
			height: 40px; 
			z-index: 10; 
			cursor: pointer;  
			color: #2d8cf0; 
			border-radius: 5px; 
			border: 1px #2d8cf0 solid; 
			background-color: white; 
			display: flex; 
			flex-direction: column; 
			justify-content: center;
			align-items: center;
		}
		.button.active {
			color: white; 
			background-color: #2d8cf0; 
		}
		.button + .button {
			margin-left: 30px;
		}
		span.accent {
			margin-top: 2px;
			border-top: 1px solid #D3D3D3;
      border-left: 1px solid #D3D3D3;
      border-right: 1px solid #D3D3D3;
			padding: 2px 2px 0 2px;
			font-size: inherit;
		}
    span.accent-bottom  {
      border-bottom: 1px solid #D3D3D3;
			padding: 0px 2px 0px 2px;
			font-size: inherit;
    }

		.lesson-frame.small-screen  > div.section + div.section {
			margin-top: 20px;
		}
		.lesson-frame.big-screen {
			display: flex; 
			flex-wrap: wrap;
		}

		.lesson-frame.big-screen > div.section + div.section {
			margin-left: 20px;
		}
		.lesson-frame > div.card, .page > div.card {
			border-radius: 5px;
			border: 2px #eee solid;
			padding: 10px;
			display: flex;
			flex-direction: row;
		}
		.page {
			/* border: 1px solid red; */
		}
		.card.print {
			border-width: 0px !important;
			padding: 0px !important;
		}
		.ul-exam {
			background-color: white;
		}
		.ul-exam > li > div{
			font-size: 20px;
		}
		.ul-exam > li + li{
			border-top: #eee 1px solid;
		}

		.ul-exam > li > div + div{
			margin-left: 20px;
		}
		.note-mark {
			color: red;
		}
		div.hover {
			cursor: pointer;
			color: #2d8cf0;
		}
		div.hover:hover {
			background: #2d8cf0;
			color: white;
		}
		.ghost {
			opacity: 0.5;
			background: #c8ebfb;
			color: #2d8cf0;
		}

		#letter-exam-keyboard > div {
			display: flex;
			flex-direction: row;
		}


		#letter-exam-keyboard > div > div {
			font-size: 30px;
			color: white; 
			background-color: #2d8cf0;
			border: 1px white solid;
			border-radius: 5px;
			display: flex;
			flex-direction: row;
			align-items: center; 
			justify-content: center;
			flex: 1;
			cursor: pointer;
		}
	</style>
</head>
<body style="overflow: hidden;">
	<div id="app" style="display: flex; flex-direction: row;">
		<div :style="{width: width + 'px'}" style="height: 100%; padding: 0px; background-color: white; margin-right: 5px; display: flex; flex-direction: column; align-items: stretch; justify-content: center;"
			v-if="open"
		>
			<div style="background: #2d8cf0; padding: 5px 0px; display: flex; flex-direction: column;  justify-content: center;" 
					:style="{height: width > 30 ? null : '100%', alignItems: width > 30 ? 'flex-end' : 'center'} ">
				<Icon v-if="width > 30" type="ios-arrow-back" size="30" style="cursor: pointer; color: white;"
					@click="width = 30"
				></Icon>
				<Icon v-else type="ios-arrow-forward" size="30" style="cursor: pointer; color: white;" @click="width = 180"></Icon>
			</div>
			<ul v-if="width > 30" class="ivu-menu" style="flex: 1;">
				<li v-for="(item1, index1) in ['五十音', '五十音測驗', '筆順練習', '字典', '大家的日本語', '單字測驗']" :key="index1" class="ivu-menu-item"
					:class="{'ivu-menu-item-active': item1 == page}"
					@click="onClick(item1);"
				>
					{{item1}}
				</li>
			</ul>
		</div>
		<div style="flex: 1;">
			<pronounce v-if="page == '五十音'"></pronounce>
			<letter-exam v-else-if="page == '五十音測驗'"></letter-exam>
			<vocabulary ref="vocabulary" v-else-if="page == '字典'"></vocabulary>
			<lesson v-else-if="page == '大家的日本語'"></lesson>
			<lesson-exam v-else-if="page == '單字測驗'"></lesson-exam>
			<letter v-else></letter>
		</div>
	</div>
</body>
<script>
	var vm = null;
	window.onload = async function(){
		let email = window.localStorage["email"];
		let password = window.localStorage["password"];
		if(location.href.indexOf("anonymous=") > -1 || location.href.indexOf("user=") > -1) {
			let key = location.href.indexOf("anonymous=") > -1 ? "anonymous=" : "user="
			let s = location.href.substr(location.href.indexOf(key) + key.length)
			let arr = s.split("&");
			s = arr[0].replace(key, "");
			s = atob(s)
			arr = s.split("\t")
			email = arr[0];
			password = arr[1];
			window.localStorage["email"] = email;
			window.localStorage["password"] = password;
		}
		// console.log(btoa(email + "\t" + password));
		if(typeof email == "string" && email.length > 0 ) {
			try {
				FireStore.initial();
				await FireStore.signIn(email, password)
				console.log("FireStore.mail: " + FireStore.mail() + "\n  id: " )
			} catch(e) {
				console.log(e)
				// alert(e.message);
			}
		}

		Vue.prototype.$isLogin = function() {
			return typeof email == "string" && email.length > 0 && FireStore.login == true;
		}

		Vue.prototype.$storage = function (key, value) {
			if(typeof key == "string" && typeof value == "undefined"){
				let s = window.localStorage[key];
				if(typeof s == "undefined"){
					return {};
				}
				return s.indexOf("{") == 0 ? JSON.parse(s) : s;
			} 
			else {
				if(value == null)
					delete window.localStorage[key];
				else
					window.localStorage[key] = typeof value == "object" ? JSON.stringify(value) : value;
			}
		}

		Vue.prototype.$queryString = function(key) {
			let index = location.href.indexOf("?");
			let s = "";
			if(index > -1) {
				let s1 = location.href.substr(index + 1);
				let arr = s1.split("&");
				for(let i = 0; i < arr.length; i++) {
					index = arr[i].indexOf(key + "=");
					if(index > -1) {
						s = arr[i].substr(key.length + 1)
						break;
					}
				}
			}
			return decodeURI(s);
		}
		Vue.prototype.$isDebug = function() {
			return email.indexOf("jimc") == 0
				|| location.href.indexOf("file:///") > -1 
				|| location.href.indexOf("192.168") > -1 
				? true : false;
		}
		Vue.prototype.$japanese = function() {
			return window.japanese();
		}
		
		Vue.prototype.$appendScript = (src) => {
			return new Promise(async (resolve, reject) => {
				let script   = document.createElement("script");
				script.type  = "text/javascript";
				script.src   = src;;
				script.onload = function(){
					resolve();
				};

				script.onerror = function(e){
					console.log(e)
					alert(e)
					reject();
				}
				document.getElementsByTagName("head")[0].appendChild(script);
			});
		}
		Vue.prototype.$removeScript = (src) => {
			let script = document.querySelector(`script[src='${src}']`);
			if(script)
				document.getElementsByTagName("head")[0].removeChild(script);
		}
		Vue.prototype.broadcast = new Vue(); // 廣播用元件

		vm = new Vue({
			el: '#app',
			data() {
				return {
					page: "五十音",
					width: document.body.clientWidth < 400 ? 30: 180,
					open: true
				};
			},
			created() {
				iview.lang('zh-TW');
				// console.log(typeof(this.$queryString('mode')) + ", " + this.$queryString('mode').length)
			},
			async mounted(){
				let self = this;
				setTimeout(() => {
					document.body.style.visibility = "visible";	
				}, 600);
				window.onresize = () => {
					return (() => {
							// self.screenWidth = document.body.clientWidth;
							self.broadcast.$emit('onResize');
					})()
				}
				let mode = this.$queryString('mode');
				if(typeof mode == "string" && mode.length > 0) {
					this.page = this.$queryString('mode');
					this.open = false;
				} else {
					let page = window.localStorage["japanese-page"];
					if(typeof page == "string" )
						this.page = page;
				}
				document.title = this.page;
			},
			methods: {
				onClick(page) {
					document.title = page;
					this.page = page;
					window.localStorage["japanese-page"] = page;
					if(document.body.clientWidth < 400)
						this.width = 30;
				}
			}
		});
	}

</script>
</html>
<!-- 
https://www.iviewui.com/view-ui-plus/component/base/icon
https://www.iviewui.com/view-ui-plus/component/form/table
https://www.iviewui.com/view-ui-plus/component/layout/split

open -a Google\ Chrome "index.html"
 -->
